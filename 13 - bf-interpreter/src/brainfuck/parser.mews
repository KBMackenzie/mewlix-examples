yarn ball brainfuck.parser

clowder Parser
  =^.x.^= wake(input)
    home.input = input
    home.index = 0
  ~meow

  =^.x.^= head()
    look if home.eof()
      home.error("Unexpected end of input!")
    ~meow

    bring std.poke(home.input, home.index)
  ~meow

  =^.x.^= advance()
    home.index = home.index + 1
    assert home.index <= home.input...?
  ~meow

  =^.x.^= eof()
    assert home.index >= 0
    bring home.index >= home.input...?
  ~meow

  =^.x.^= error(message)
    home.index = std.min(home.index, home.input...?)

    =^.x.^= generate_snippet()
      mew preview_length = std.min(20, home.input...? - home.index)
      bring std.tear(home.input, home.index, home.index + preview_length)
    ~meow

    mew snippet = "<eof>" if home.eof() else generate_snippet()
    throw :3"Brainfuck parser error: [message] | Input: [snippet]"
  ~meow
~meow
